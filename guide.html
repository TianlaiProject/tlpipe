

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developer’s guide &mdash; tlpipe 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="tlpipe 0.1 documentation" href="index.html"/>
        <link rel="next" title="core – Core functionalities" href="core.html"/>
        <link rel="prev" title="Tutorial" href="tutor.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> tlpipe
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#python-version">Python version</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-guid">Installation guid</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutor.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutor.html#prepare-for-the-input-pipe-file">Prepare for the input pipe file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutor.html#non-iterative-pipeline">Non-iterative pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutor.html#iterative-pipeline">Iterative pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutor.html#non-trivial-control-flow">Non-trivial control flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutor.html#execute-several-times-a-same-task">Execute several times a same task</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutor.html#save-intermediate-data">Save intermediate data</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutor.html#recovery-from-intermediate-data">Recovery from intermediate data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutor.html#run-the-pipeline">Run the pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutor.html#single-process-run">Single process run</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutor.html#multiple-processes-run">Multiple processes run</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutor.html#pipeline-products-and-intermediate-results">Pipeline products and intermediate results</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutor.html#other-excutable-commands">Other excutable commands</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer&#8217;s guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#write-a-general-task">Write a general task</a></li>
<li class="toctree-l2"><a class="reference internal" href="#write-a-task-to-process-timestream-data">Write a task to process timestream data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-data-operate-functions-in-timestream-tasks">Use data operate functions in timestream tasks</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core.html"><code class="docutils literal"><span class="pre">core</span></code> &#8211; Core functionalities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="core.html#constants">Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.core.constants.html">tlpipe.core.constants</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.core.constants.html#constants">Constants</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="core.html#tianlai-array-model">Tianlai array model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.core.tl_array.html">tlpipe.core.tl_array</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.core.tl_array.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kiyopy.html"><code class="docutils literal"><span class="pre">kiyopy</span></code> &#8211; Kiyoshi Masui&#8217;s paramter parsing package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="kiyopy.html#pameter-parser">Pameter parser</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.kiyopy.parse_ini.html">tlpipe.kiyopy.parse_ini</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.parse_ini.parse.html">tlpipe.kiyopy.parse_ini.parse</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.parse_ini.parse_dict.html">tlpipe.kiyopy.parse_ini.parse_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.parse_ini.write_params.html">tlpipe.kiyopy.parse_ini.write_params</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kiyopy.html#custom-exceptions">Custom exceptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.kiyopy.custom_exceptions.html">tlpipe.kiyopy.custom_exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.custom_exceptions.DataError.html">tlpipe.kiyopy.custom_exceptions.DataError</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.custom_exceptions.FileParameterTypeError.html">tlpipe.kiyopy.custom_exceptions.FileParameterTypeError</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.custom_exceptions.NextIteration.html">tlpipe.kiyopy.custom_exceptions.NextIteration</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.custom_exceptions.ParameterFileError.html">tlpipe.kiyopy.custom_exceptions.ParameterFileError</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kiyopy.html#utilities">Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.kiyopy.utils.html">tlpipe.kiyopy.utils</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.utils.abbreviate_file_path.html">tlpipe.kiyopy.utils.abbreviate_file_path</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.utils.mkdir_p.html">tlpipe.kiyopy.utils.mkdir_p</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.kiyopy.utils.mkparents.html">tlpipe.kiyopy.utils.mkparents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html"><code class="docutils literal"><span class="pre">pipeline</span></code> &#8211; Pipeline control and tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html#pipeline">Pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.pipeline.pipeline.html">tlpipe.pipeline.pipeline</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.pipeline.pipeline.html#basic-tasks">Basic Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.pipeline.pipeline.html#pipeline-configuration">Pipeline Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.pipeline.pipeline.html#execution-order">Execution Order</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.pipeline.pipeline.html#advanced-tasks">Advanced Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.pipeline.pipeline.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="container.html"><code class="docutils literal"><span class="pre">container</span></code> &#8211; Timestream data containers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="container.html#data-containers">Data containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.container.container.html">tlpipe.container.container</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.container.container.check_axis.html">tlpipe.container.container.check_axis</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.container.container.deepcopy.html">tlpipe.container.container.deepcopy</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.container.container.ensure_file_list.html">tlpipe.container.container.ensure_file_list</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.container.container.BasicTod.html">tlpipe.container.container.BasicTod</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.container.timestream_common.html">tlpipe.container.timestream_common</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.container.timestream_common.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.container.raw_timestream.html">tlpipe.container.raw_timestream</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.container.raw_timestream.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.container.timestream.html">tlpipe.container.timestream</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.container.timestream.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timestream.html"><code class="docutils literal"><span class="pre">timestream</span></code> &#8211; Timestream operating tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="timestream.html#timestream-base-task">Timestream base task</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.timestream_task.html">tlpipe.timestream.timestream_task</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.timestream_task.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timestream.html#operating-tasks">Operating tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.dispatch.html">tlpipe.timestream.dispatch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.dispatch.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.detect_ns.html">tlpipe.timestream.detect_ns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.detect_ns.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.rfi_flagging.html">tlpipe.timestream.rfi_flagging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.rfi_flagging.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.line_rfi.html">tlpipe.timestream.line_rfi</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.line_rfi.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.time_flag.html">tlpipe.timestream.time_flag</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.time_flag.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.freq_flag.html">tlpipe.timestream.freq_flag</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.freq_flag.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.multiscale_flag.html">tlpipe.timestream.multiscale_flag</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.multiscale_flag.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.combine_mask.html">tlpipe.timestream.combine_mask</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.combine_mask.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.sir_operate.html">tlpipe.timestream.sir_operate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.sir_operate.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.rfi_stats.html">tlpipe.timestream.rfi_stats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.rfi_stats.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.subdata.html">tlpipe.timestream.subdata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.subdata.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.bad_detect.html">tlpipe.timestream.bad_detect</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.bad_detect.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.ns_cal.html">tlpipe.timestream.ns_cal</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.ns_cal.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.rt2ts.html">tlpipe.timestream.rt2ts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.rt2ts.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.ps_fit.html">tlpipe.timestream.ps_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.ps_fit.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.ps_cal.html">tlpipe.timestream.ps_cal</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.ps_cal.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.phs2src.html">tlpipe.timestream.phs2src</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.phs2src.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.phs2zen.html">tlpipe.timestream.phs2zen</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.phs2zen.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.phase_closure.html">tlpipe.timestream.phase_closure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.phase_closure.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.ps_subtract.html">tlpipe.timestream.ps_subtract</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.ps_subtract.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.daytime_mask.html">tlpipe.timestream.daytime_mask</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.daytime_mask.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.re_order.html">tlpipe.timestream.re_order</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.re_order.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.accumulate.html">tlpipe.timestream.accumulate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.accumulate.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.barrier.html">tlpipe.timestream.barrier</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.barrier.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.average.html">tlpipe.timestream.average</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.average.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.freq_rebin.html">tlpipe.timestream.freq_rebin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.freq_rebin.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.timestream.map_making.html">tlpipe.timestream.map_making</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.timestream.map_making.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rfi.html"><code class="docutils literal"><span class="pre">rfi</span></code> &#8211; RFI flagging methods</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rfi.html#surface-fitting-methods">Surface fitting methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.surface_fit.html">tlpipe.rfi.surface_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.surface_fit.SurfaceFitMethod.html">tlpipe.rfi.surface_fit.SurfaceFitMethod</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.local_fit.html">tlpipe.rfi.local_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.local_fit.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.local_average_fit.html">tlpipe.rfi.local_average_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.local_average_fit.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.local_median_fit.html">tlpipe.rfi.local_median_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.local_median_fit.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.local_minimum_fit.html">tlpipe.rfi.local_minimum_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.local_minimum_fit.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.gaussian_filter.html">tlpipe.rfi.gaussian_filter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.gaussian_filter.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.interpolate.html">tlpipe.rfi.interpolate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.interpolate.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rfi.html#combinatorial-thresholding-methods">Combinatorial thresholding methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.combinatorial_threshold.html">tlpipe.rfi.combinatorial_threshold</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.combinatorial_threshold.winsorized_mean_and_std.html">tlpipe.rfi.combinatorial_threshold.winsorized_mean_and_std</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.combinatorial_threshold.winsorized_mode.html">tlpipe.rfi.combinatorial_threshold.winsorized_mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.combinatorial_threshold.CombinatorialThreshold.html">tlpipe.rfi.combinatorial_threshold.CombinatorialThreshold</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.var_threshold.html">tlpipe.rfi.var_threshold</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.var_threshold.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.sum_threshold.html">tlpipe.rfi.sum_threshold</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.sum_threshold.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rfi.html#mathematical-morphological-methods">Mathematical morphological methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.dilate_operator.html">tlpipe.rfi.dilate_operator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.dilate_operator.dilate1d.html">tlpipe.rfi.dilate_operator.dilate1d</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.dilate_operator.horizontal_dilate.html">tlpipe.rfi.dilate_operator.horizontal_dilate</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.dilate_operator.vertical_dilate.html">tlpipe.rfi.dilate_operator.vertical_dilate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.rfi.sir_operator.html">tlpipe.rfi.sir_operator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.sir_operator.horizontal_sir.html">tlpipe.rfi.sir_operator.horizontal_sir</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.sir_operator.sir1d.html">tlpipe.rfi.sir_operator.sir1d</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.rfi.sir_operator.vertical_sir.html">tlpipe.rfi.sir_operator.vertical_sir</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cal.html"><code class="docutils literal"><span class="pre">cal</span></code> &#8211; Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="map.html"><code class="docutils literal"><span class="pre">map</span></code> &#8211; Map-making</a><ul>
<li class="toctree-l2"><a class="reference internal" href="map.html#driftscan-map-making">Driftscan map-making</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="foreground.html"><code class="docutils literal"><span class="pre">foreground</span></code> &#8211; Foreground subtraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ps.html"><code class="docutils literal"><span class="pre">ps</span></code> &#8211; Power spectrum estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot.html"><code class="docutils literal"><span class="pre">plot</span></code> &#8211; Tasks for plottting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plot.html#plotting-tasks">Plotting tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.plot.plot_integral.html">tlpipe.plot.plot_integral</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.plot.plot_integral.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.plot.plot_slice.html">tlpipe.plot.plot_slice</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.plot.plot_slice.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.plot.plot_waterfall.html">tlpipe.plot.plot_waterfall</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.plot.plot_waterfall.html#inheritance-diagram">Inheritance diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="utils.html"><code class="docutils literal"><span class="pre">utils</span></code> &#8211; Utility functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="utils.html#utilities">Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.date_util.html">tlpipe.utils.date_util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.date_util.get_ephdate.html">tlpipe.utils.date_util.get_ephdate</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.date_util.get_juldate.html">tlpipe.utils.date_util.get_juldate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.np_util.html">tlpipe.utils.np_util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.np_util.average.html">tlpipe.utils.np_util.average</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.np_util.unique.html">tlpipe.utils.np_util.unique</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.path_util.html">tlpipe.utils.path_util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.path_util.input_path.html">tlpipe.utils.path_util.input_path</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.path_util.iter_path.html">tlpipe.utils.path_util.iter_path</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.path_util.output_path.html">tlpipe.utils.path_util.output_path</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.pickle_util.html">tlpipe.utils.pickle_util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.pickle_util.get_value.html">tlpipe.utils.pickle_util.get_value</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.robust_stats.html">tlpipe.utils.robust_stats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.robust_stats.MAD.html">tlpipe.utils.robust_stats.MAD</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.robust_stats.mad.html">tlpipe.utils.robust_stats.mad</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.robust_stats.winsorize.html">tlpipe.utils.robust_stats.winsorize</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.robust_stats.winsorized_mean_and_std.html">tlpipe.utils.robust_stats.winsorized_mean_and_std</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.robust_stats.winsorized_mode.html">tlpipe.utils.robust_stats.winsorized_mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.sg_filter.html">tlpipe.utils.sg_filter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.sg_filter.factorial.html">tlpipe.utils.sg_filter.factorial</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.sg_filter.savitzky_golay.html">tlpipe.utils.sg_filter.savitzky_golay</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.html">tlpipe.utils.rpca_decomp</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.MAD.html">tlpipe.utils.rpca_decomp.MAD</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.decompose.html">tlpipe.utils.rpca_decomp.decompose</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.l0_norm.html">tlpipe.utils.rpca_decomp.l0_norm</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.l1_norm.html">tlpipe.utils.rpca_decomp.l1_norm</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.mad.html">tlpipe.utils.rpca_decomp.mad</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.shrink.html">tlpipe.utils.rpca_decomp.shrink</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.sign.html">tlpipe.utils.rpca_decomp.sign</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.rpca_decomp.truncate.html">tlpipe.utils.rpca_decomp.truncate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.multiscale.html">tlpipe.utils.multiscale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.MAD.html">tlpipe.utils.multiscale.MAD</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.convolve.html">tlpipe.utils.multiscale.convolve</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.convolve1d.html">tlpipe.utils.multiscale.convolve1d</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.median_filter.html">tlpipe.utils.multiscale.median_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.median_wavelet_detrend.html">tlpipe.utils.multiscale.median_wavelet_detrend</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.median_wavelet_smooth.html">tlpipe.utils.multiscale.median_wavelet_smooth</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.median_wavelet_transform.html">tlpipe.utils.multiscale.median_wavelet_transform</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.multiscale_median_detrend.html">tlpipe.utils.multiscale.multiscale_median_detrend</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.multiscale_median_flag.html">tlpipe.utils.multiscale.multiscale_median_flag</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.multiscale_median_smooth.html">tlpipe.utils.multiscale.multiscale_median_smooth</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.multiscale_median_transform.html">tlpipe.utils.multiscale.multiscale_median_transform</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.starlet_detrend.html">tlpipe.utils.multiscale.starlet_detrend</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.starlet_smooth.html">tlpipe.utils.multiscale.starlet_smooth</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.starlet_transform.html">tlpipe.utils.multiscale.starlet_transform</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.multiscale.up_sampling.html">tlpipe.utils.multiscale.up_sampling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="generated/tlpipe.utils.hist_eq.html">tlpipe.utils.hist_eq</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/tlpipe.utils.hist_eq.hist_eq.html">tlpipe.utils.hist_eq.hist_eq</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">tlpipe</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Developer&#8217;s guide</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/guide.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="developer-s-guide">
<h1>Developer&#8217;s guide<a class="headerlink" href="#developer-s-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="write-a-general-task">
<h2>Write a general task<a class="headerlink" href="#write-a-general-task" title="Permalink to this headline">¶</a></h2>
<p>A pipeline task is a subclass of <a class="reference internal" href="generated/tlpipe.pipeline.pipeline.TaskBase.html#tlpipe.pipeline.pipeline.TaskBase" title="tlpipe.pipeline.pipeline.TaskBase"><code class="xref py py-class docutils literal"><span class="pre">TaskBase</span></code></a>
intended to perform some small, modular piece analysis.</p>
<p>To write a general task, you can use the following template
<a class="reference download internal" href="_downloads/general_task.py" download=""><code class="xref download docutils literal"><span class="pre">general_task.py</span></code></a>:</p>
<blockquote>
<div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;A general task template.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">tlpipe.pipeline.pipeline</span> <span class="kn">import</span> <span class="n">TaskBase</span><span class="p">,</span> <span class="n">PipelineStopIteration</span>


<span class="k">class</span> <span class="nc">GeneralTask</span><span class="p">(</span><span class="n">TaskBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A general task template.&quot;&quot;&quot;</span>

    <span class="c"># input parameters and their default values as a dictionary</span>
    <span class="n">params_init</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;task_param&#39;</span><span class="p">:</span> <span class="s">&#39;param_val&#39;</span><span class="p">,</span>
                  <span class="p">}</span>

    <span class="c"># prefix of this task</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;gt_&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_file_or_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">feedback</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>

        <span class="c"># Read in the parameters.</span>
        <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parameter_file_or_dict</span><span class="p">,</span> <span class="n">feedback</span><span class="p">)</span>

        <span class="c"># Do some initialization here if necessary</span>
        <span class="k">print</span> <span class="s">&#39;Initialize the task.&#39;</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Set up works here if necessary</span>
        <span class="k">print</span> <span class="s">&quot;Setting up the task.&quot;</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Doing the actual work here</span>
        <span class="k">print</span> <span class="s">&#39;Executing the task with paramter task_param = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;task_param&#39;</span><span class="p">]</span>
        <span class="c"># stop the task</span>
        <span class="k">raise</span> <span class="n">PipelineStopIteration</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Finishing works here if necessary</span>
        <span class="k">print</span> <span class="s">&quot;Finished the task.&quot;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>The developer of the task must specify what input parameters the task
expects if it has and a prefix, as well as code to perform the actual
processing for the task.</p>
<p>Input parameters are specified by adding class attributes <cite>params_init</cite>
which is a dictionary whose entries are key and default value pairs.
A <cite>prefix</cite> is used to identify and read the corresponding parameters
from the input pipe file for this task.</p>
<p>To perform the actual processing for the task, you could first do the
necessary initialization in <code class="xref py py-meth docutils literal"><span class="pre">__init__()</span></code>, then implement three
methods <code class="xref py py-meth docutils literal"><span class="pre">setup()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">next()</span></code> and <code class="xref py py-meth docutils literal"><span class="pre">finish()</span></code>. Usually the only
necessary method to be implemented is <code class="xref py py-meth docutils literal"><span class="pre">next()</span></code>, in which the actual
processing works are done, the other methods <code class="xref py py-meth docutils literal"><span class="pre">__init__()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">setup()</span></code>,
<code class="xref py py-meth docutils literal"><span class="pre">finish()</span></code> do not need if there is no specifical initialization,
setting up, and finishing work to do. These methods are executed in order,
with <code class="xref py py-meth docutils literal"><span class="pre">next()</span></code> possibly being executed many times. Iteration of
<code class="xref py py-meth docutils literal"><span class="pre">next()</span></code> is halted by raising a <code class="xref py py-exc docutils literal"><span class="pre">PipelineStopIteration</span></code>.</p>
<p>To make it work, you could put it somewhere like in <cite>tlpipe/tlpipe/timestream/</cite>,
and write a input pipe file like
<a class="reference download internal" href="_downloads/general_task.pipe" download=""><code class="xref download docutils literal"><span class="pre">general_task.pipe</span></code></a>:</p>
<blockquote>
<div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- mode: python; -*-</span>

<span class="c"># input file for pipeline manager</span>
<span class="c"># execute this pipeline by either command of the following two:</span>
<span class="c"># tlpipe dir/to/general_task.pipe</span>
<span class="c"># mpiexec -n N tlpipe dir/to/general_task.pipe</span>


<span class="n">pipe_tasks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pipe_outdir</span> <span class="o">=</span> <span class="s">&#39;./output/&#39;</span>


<span class="kn">from</span> <span class="nn">tlpipe.timestream</span> <span class="kn">import</span> <span class="n">general_task</span>
<span class="n">pipe_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">general_task</span><span class="o">.</span><span class="n">GeneralTask</span><span class="p">)</span>
<span class="c">### parameters for GeneralTask</span>
<span class="n">gt_task_param</span> <span class="o">=</span> <span class="s">&#39;new_val&#39;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>then execute the task by run</p>
<div class="highlight-default"><div class="highlight"><pre>$ tlpipe general_task.pipe
</pre></div>
</div>
</div>
<div class="section" id="write-a-task-to-process-timestream-data">
<h2>Write a task to process timestream data<a class="headerlink" href="#write-a-task-to-process-timestream-data" title="Permalink to this headline">¶</a></h2>
<p>To write a task to process the timestream data (i.e., the visibility and
auxiliary data), you can use the following template
<a class="reference download internal" href="_downloads/ts_template.py" download=""><code class="xref download docutils literal"><span class="pre">ts_template.py</span></code></a>:</p>
<blockquote>
<div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;Timestream task template.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">timestream_task</span>


<span class="k">class</span> <span class="nc">TsTemplate</span><span class="p">(</span><span class="n">timestream_task</span><span class="o">.</span><span class="n">TimestreamTask</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Timestream task template.&quot;&quot;&quot;</span>

    <span class="n">params_init</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;task_param&#39;</span><span class="p">:</span> <span class="s">&#39;param_val&#39;</span><span class="p">,</span>
                  <span class="p">}</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;tt_&#39;</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>

        <span class="k">print</span> <span class="s">&#39;Executing the task with paramter task_param = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;task_param&#39;</span><span class="p">]</span>
        <span class="k">print</span>
        <span class="k">print</span> <span class="s">&#39;Timestream data is contained in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ts</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TsTemplate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>Here, instead of inherit from <a class="reference internal" href="generated/tlpipe.pipeline.pipeline.TaskBase.html#tlpipe.pipeline.pipeline.TaskBase" title="tlpipe.pipeline.pipeline.TaskBase"><code class="xref py py-class docutils literal"><span class="pre">TaskBase</span></code></a>,
we inherit from its subclass
<a class="reference internal" href="generated/tlpipe.timestream.timestream_task.TimestreamTask.html#tlpipe.timestream.timestream_task.TimestreamTask" title="tlpipe.timestream.timestream_task.TimestreamTask"><code class="xref py py-class docutils literal"><span class="pre">TimestreamTask</span></code></a>, and implement
the method <code class="xref py py-meth docutils literal"><span class="pre">process()</span></code> (and maybe also <code class="xref py py-meth docutils literal"><span class="pre">__init__()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">setup()</span></code>,
and <code class="xref py py-meth docutils literal"><span class="pre">finish()</span></code> if necessary). The timestream data is contained in the
argument <em>ts</em>, which may be an instance of
<a class="reference internal" href="generated/tlpipe.container.raw_timestream.RawTimestream.html#tlpipe.container.raw_timestream.RawTimestream" title="tlpipe.container.raw_timestream.RawTimestream"><code class="xref py py-class docutils literal"><span class="pre">RawTimestream</span></code></a> or
<a class="reference internal" href="generated/tlpipe.container.timestream.Timestream.html#tlpipe.container.timestream.Timestream" title="tlpipe.container.timestream.Timestream"><code class="xref py py-class docutils literal"><span class="pre">Timestream</span></code></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You do not need to override the method <code class="xref py py-meth docutils literal"><span class="pre">next()</span></code> now, because in the
class <a class="reference internal" href="generated/tlpipe.pipeline.pipeline.OneAndOne.html#tlpipe.pipeline.pipeline.OneAndOne" title="tlpipe.pipeline.pipeline.OneAndOne"><code class="xref py py-class docutils literal"><span class="pre">OneAndOne</span></code></a>, which is the super
class of <a class="reference internal" href="generated/tlpipe.timestream.timestream_task.TimestreamTask.html#tlpipe.timestream.timestream_task.TimestreamTask" title="tlpipe.timestream.timestream_task.TimestreamTask"><code class="xref py py-class docutils literal"><span class="pre">TimestreamTask</span></code></a>, we
have</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">OneAndOne</span><span class="p">(</span><span class="n">TaskBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># ...</span>
<span class="hll">        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_process_write</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span>        <span class="c"># ...</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">read_process_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="c"># ...</span>
<span class="hll">        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span>        <span class="c"># ...</span>
        <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-data-operate-functions-in-timestream-tasks">
<h2>Use data operate functions in timestream tasks<a class="headerlink" href="#use-data-operate-functions-in-timestream-tasks" title="Permalink to this headline">¶</a></h2>
<p>To write a task to process the timestream data, you (in most cases) only
need to implement <code class="xref py py-meth docutils literal"><span class="pre">process()</span></code> with the input timestream data contained
in its argument <em>ts</em>, as stated above. To help with the data processing, you
could use some of the data operate functions defined in the corresponding
timestream data container class, which can automatically split the data along
one axis or some axes among multiple process and iteratively process all these
data slices. For example, to write to task to process the raw timestream data
along the axis of baseline, i.e., to process a time-frequency slice of the
raw data each time, you can have the task like
<a class="reference download internal" href="_downloads/ts_task.py" download=""><code class="xref download docutils literal"><span class="pre">ts_task.py</span></code></a>:</p>
<blockquote>
<div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;A task to process the raw timestream data along the axis of baseline.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">timestream_task</span>


<span class="k">class</span> <span class="nc">TsTask</span><span class="p">(</span><span class="n">timestream_task</span><span class="o">.</span><span class="n">TimestreamTask</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A task to process the raw timestream data along the axis of baseline.&quot;&quot;&quot;</span>

    <span class="n">params_init</span> <span class="o">=</span> <span class="p">{</span>
                  <span class="p">}</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;tt_&#39;</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>

        <span class="c"># distribute data along the axis of baseline</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">redistribute</span><span class="p">(</span><span class="s">&#39;baseline&#39;</span><span class="p">)</span>

        <span class="c"># use data operate function of `ts`</span>
<span class="hll">        <span class="n">ts</span><span class="o">.</span><span class="n">bl_data_operate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TsTask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vis</span><span class="p">,</span> <span class="n">vis_mask</span><span class="p">,</span> <span class="n">li</span><span class="p">,</span> <span class="n">gi</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that does the actual task.&quot;&quot;&quot;</span>

        <span class="c"># `vis` is the time-frequency slice of the visibility</span>
        <span class="k">print</span> <span class="n">vis</span><span class="o">.</span><span class="n">shape</span>
        <span class="c"># `vis_mask` is the time-frequency slice of the visibility mask</span>
        <span class="k">print</span> <span class="n">vis_mask</span><span class="o">.</span><span class="n">shape</span>
        <span class="c"># `li`, `gi` is the local and global index of this slice</span>
        <span class="c"># `bl` is the corresponding baseline</span>
        <span class="k">print</span> <span class="n">li</span><span class="p">,</span> <span class="n">gi</span><span class="p">,</span> <span class="n">bl</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>To execute the task, put it somewhere like in <cite>tlpipe/tlpipe/timestream/</cite>,
and write a input pipe file like
<a class="reference download internal" href="_downloads/ts_task.pipe" download=""><code class="xref download docutils literal"><span class="pre">ts_task.pipe</span></code></a>:</p>
<blockquote>
<div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- mode: python; -*-</span>

<span class="c"># input file for pipeline manager</span>
<span class="c"># execute this pipeline by either command of the following two:</span>
<span class="c"># tlpipe dir/to/ts_task.pipe</span>
<span class="c"># mpiexec -n N tlpipe dir/to/ts_task.pipe</span>


<span class="n">pipe_tasks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pipe_outdir</span> <span class="o">=</span> <span class="s">&#39;./output/&#39;</span>
<span class="n">pipe_logging</span> <span class="o">=</span> <span class="s">&#39;notset&#39;</span>
<span class="c"># pipe_logging = &#39;info&#39;</span>
<span class="n">pipe_timing</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">pipe_flush</span> <span class="o">=</span> <span class="bp">True</span>


<span class="kn">import</span> <span class="nn">glob</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="s">&#39;dir/to/data&#39;</span> <span class="c"># your data directory</span>
<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">data_dir</span><span class="o">+</span><span class="s">&#39;/*.hdf5&#39;</span><span class="p">))</span> <span class="c"># all data files as a list</span>


<span class="c"># data selection</span>
<span class="kn">from</span> <span class="nn">tlpipe.timestream</span> <span class="kn">import</span> <span class="n">dispatch</span>
<span class="n">pipe_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dispatch</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">)</span>
<span class="c">### parameters for Dispatch</span>
<span class="n">dp_input_files</span> <span class="o">=</span> <span class="n">files</span> <span class="c"># data files as list</span>
<span class="n">dp_freq_select</span> <span class="o">=</span> <span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">510</span><span class="p">)</span> <span class="c"># frequency indices, from 500 to 510</span>
<span class="n">dp_feed_select</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">]</span> <span class="c"># feed no. as a list</span>
<span class="n">dp_out</span> <span class="o">=</span> <span class="s">&#39;dp&#39;</span>

<span class="kn">from</span> <span class="nn">tlpipe.timestream</span> <span class="kn">import</span> <span class="n">ts_task</span>
<span class="n">pipe_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts_task</span><span class="o">.</span><span class="n">TsTask</span><span class="p">)</span>
<span class="c">### parameters for TsTask</span>
<span class="n">tt_in</span> <span class="o">=</span> <span class="n">dp_out</span>
<span class="n">tt_out</span> <span class="o">=</span> <span class="s">&#39;tt&#39;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>then execute the task by run</p>
<div class="highlight-default"><div class="highlight"><pre>$ tlpipe ts_task.pipe
</pre></div>
</div>
<p>These are some data operate functions that you can use:</p>
<p>Data operate functions of
<a class="reference internal" href="generated/tlpipe.container.raw_timestream.RawTimestream.html#tlpipe.container.raw_timestream.RawTimestream" title="tlpipe.container.raw_timestream.RawTimestream"><code class="xref py py-class docutils literal"><span class="pre">RawTimestream</span></code></a> and
<a class="reference internal" href="generated/tlpipe.container.timestream.Timestream.html#tlpipe.container.timestream.Timestream" title="tlpipe.container.timestream.Timestream"><code class="xref py py-class docutils literal"><span class="pre">Timestream</span></code></a>:</p>
<blockquote>
<div><dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">tlpipe.container.timestream_common.</code><code class="descname">TimestreamCommon</code></dt>
<dd><dl class="method">
<dt>
<code class="descname">data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>op_axis=None</em>, <em>axis_vals=0</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">all_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>copy_data=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">time_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">freq_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">bl_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">time_and_freq_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">time_and_bl_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">freq_and_bl_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

</div></blockquote>
<p>Additional data operate functions of <a class="reference internal" href="generated/tlpipe.container.timestream.Timestream.html#tlpipe.container.timestream.Timestream" title="tlpipe.container.timestream.Timestream"><code class="xref py py-class docutils literal"><span class="pre">Timestream</span></code></a>:</p>
<blockquote>
<div><dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">tlpipe.container.timestream.</code><code class="descname">Timestream</code></dt>
<dd><dl class="method">
<dt>
<code class="descname">pol_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">time_and_pol_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">freq_and_pol_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">pol_and_bl_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">time_freq_and_pol_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">time_freq_and_bl_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">time_pol_and_bl_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">freq_pol_and_bl_data_operate</code><span class="sig-paren">(</span><em>func</em>, <em>full_data=False</em>, <em>copy_data=False</em>, <em>keep_dist_axis=False</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

</div></blockquote>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="core.html" class="btn btn-neutral float-right" title="core – Core functionalities" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutor.html" class="btn btn-neutral" title="Tutorial" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Shifan Zuo.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>